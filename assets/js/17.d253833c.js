(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{169:function(t,s,e){"use strict";e.r(s);var a=e(0),n=Object(a.a)({},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"content"},[t._m(0),t._v(" "),e("p",[t._v("https://hub.docker.com/r/twang2218/gitlab-ce-zh/")]),t._v(" "),t._m(1),t._v(" "),t._m(2),t._m(3),t._v(" "),t._m(4),t._m(5),t._m(6),t._v(" "),t._m(7),t._m(8),t._v(" "),e("p",[t._v("如需卸载服务及相关内容，可以执行：")]),t._v(" "),t._m(9),t._m(10),t._v(" "),t._m(11),t._v(" "),t._m(12),t._v(" "),e("p",[t._v("修改/etc/selinux/config文件中设置")]),t._v(" "),e("p",[t._v("SELINUX=disabled")]),t._v(" "),e("p",[t._v("然后重启服务器。reboot")]),t._v(" "),t._m(13),t._v(" "),e("p",[t._v("使用命令setenforce 0")]),t._v(" "),e("p",[t._v("附：")]),t._v(" "),e("p",[t._v("setenforce 1 设置SELinux 成为enforcing模式")]),t._v(" "),e("p",[t._v("setenforce 0 设置SELinux 成为permissive模式")]),t._v(" "),e("p",[t._v("谢谢！")]),t._v(" "),e("p",[e("a",{attrs:{href:"https://hub.docker.com/r/denghui/gitlab-ce-zh/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://hub.docker.com/r/denghui/gitlab-ce-zh/"),e("OutboundLink")],1)]),t._v(" "),e("p",[e("a",{attrs:{href:"https://hub.docker.com/r/twang2218/gitlab-ce-zh/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://hub.docker.com/r/twang2218/gitlab-ce-zh/"),e("OutboundLink")],1)]),t._v(" "),t._m(14),e("p",[t._v("找到“#Port 22”，这一行直接键入“yyp”复制该行到下一行，然后把两行的“#”号即注释去掉，修改成：")]),t._v(" "),e("p",[t._v("Port 22")]),t._v(" "),e("p",[t._v("Port 10086")]),t._v(" "),e("p",[t._v("SSH默认监听端口是22，如果你不强制说明别的端口，”Port 22”注不注释都是开放22访问端口。上面我保留了22端口，防止之后因为各种权限和配置问题，导致连22端口都不能访问了，那就尴尬了。等一切都ok了，再关闭22端口。")]),t._v(" "),e("p",[t._v("Ok，继续，我增加了10086端口，大家修改端口时候最好挑10000~65535之间的端口号，10000以下容易被系统或一些特殊软件占用，或是以后新应用准备占用该端口的时候，却被你先占用了，导致软件无法运行。")]),t._v(" "),t._m(15),t._v(" "),e("p",[t._v("先查看SELinux开放给ssh使用的端口")]),t._v(" "),t._m(16),e("p",[t._v("我的系统打印如下：")]),t._v(" "),e("p",[t._v("ssh_port_t                    tcp      22")]),t._v(" "),e("p",[t._v("可知，SELinux没有给SSH开放10086端口，那么我们来添加该端口：")]),t._v(" "),t._m(17),e("p",[t._v("完成后，再次查看")]),t._v(" "),t._m(18),e("p",[t._v("ssh_port_t                    tcp      22，10086")]),t._v(" "),e("p",[t._v("**第三步：**如果你关闭了防火墙，可以忽略第三步，话说防火墙不开启太危险了，建议开启。")]),t._v(" "),e("p",[t._v("先查看防火墙是否开启了10086端口：")]),t._v(" "),t._m(19),e("p",[t._v("打印结果如下：")]),t._v(" "),e("p",[t._v("no")]),t._v(" "),e("p",[t._v("表示没有开放10086端口，那么添加下该端口：")]),t._v(" "),t._m(20),e("p",[t._v("打印结果如下：")]),t._v(" "),e("p",[t._v("success")]),t._v(" "),e("p",[t._v("重新加载防火墙策略：")]),t._v(" "),t._m(21),t._v(" "),e("p",[t._v("下面的代码很重要")]),t._v(" "),t._m(22),e("p",[t._v("https://blog.csdn.net/yym6789/article/details/53807640")])])},[function(){var t=this.$createElement,s=this._self._c||t;return s("h1",{attrs:{id:"docker安装gitlab"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker安装gitlab","aria-hidden":"true"}},[this._v("#")]),this._v(" Docker安装gitlab")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"一、docker-compose安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#一、docker-compose安装","aria-hidden":"true"}},[this._v("#")]),this._v(" 一、docker-compose安装")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-xml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-xml"}},[e("code",[t._v("version: '2'\nservices:\n  web:\n    image: 'twang2218/gitlab-ce-zh:11.1.4'\n    restart: always\n    hostname: '192.168.1.107'\n    container_name: gitlab\n    environment:\n      TZ: 'Asia/Shanghai'\n      GITLAB_OMNIBUS_CONFIG: |\n        external_url 'http://192.168.1.107:80'\n        gitlab_rails['gitlab_shell_ssh_port'] = 22\n        unicorn['port'] = 8888\n        nginx['listen_port'] = 80\n    ports:\n      - '80:80'\n      - '443:443'\n      - '22:22'\n    volumes:\n      - /usr/local/docker/gitlab/config:/etc/gitlab\n      - /usr/local/docker/gitlab/data:/var/opt/gitlab\n      - /usr/local/docker/gitlab/logs:/var/log/gitlab\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br"),e("span",{staticClass:"line-number"},[t._v("9")]),e("br"),e("span",{staticClass:"line-number"},[t._v("10")]),e("br"),e("span",{staticClass:"line-number"},[t._v("11")]),e("br"),e("span",{staticClass:"line-number"},[t._v("12")]),e("br"),e("span",{staticClass:"line-number"},[t._v("13")]),e("br"),e("span",{staticClass:"line-number"},[t._v("14")]),e("br"),e("span",{staticClass:"line-number"},[t._v("15")]),e("br"),e("span",{staticClass:"line-number"},[t._v("16")]),e("br"),e("span",{staticClass:"line-number"},[t._v("17")]),e("br"),e("span",{staticClass:"line-number"},[t._v("18")]),e("br"),e("span",{staticClass:"line-number"},[t._v("19")]),e("br"),e("span",{staticClass:"line-number"},[t._v("20")]),e("br"),e("span",{staticClass:"line-number"},[t._v("21")]),e("br"),e("span",{staticClass:"line-number"},[t._v("22")]),e("br")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"二、命令行安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#二、命令行安装","aria-hidden":"true"}},[this._v("#")]),this._v(" 二、命令行安装")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[this._v("docker network create gitlab-net\n")])]),this._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[this._v("1")]),s("br")])])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("docker run -d \\\n    --hostname 192.168.52.131 \\\n    -p 80:80 \\\n    -p 443:443 \\\n    -p 22:22 \\\n    --name gitlab \\\n    --restart unless-stopped \\\n    -v gitlab-config:/etc/gitlab \\\n    -v gitlab-logs:/var/log/gitlab \\\n    -v gitlab-data:/var/opt/gitlab \\\n    --network gitlab-net \\\n    twang2218/gitlab-ce-zh:11.1.4\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br"),e("span",{staticClass:"line-number"},[t._v("9")]),e("br"),e("span",{staticClass:"line-number"},[t._v("10")]),e("br"),e("span",{staticClass:"line-number"},[t._v("11")]),e("br"),e("span",{staticClass:"line-number"},[t._v("12")]),e("br")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("如果需要进入容器修改配置文件，可以用 "),s("code",[this._v("docker exec")]),this._v(" 命令进入容器：")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('$ docker exec -it gitlab bash\nroot@09f6e32c528c:/# vi /etc/gitlab/gitlab.rb\nroot@09f6e32c528c:/# gitlab-ctl reconfigure\nStarting Chef Client, version 12.12.15\nresolving cookbooks for run list: ["gitlab"]\n...\n')])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("如需停止服务，直接运行 "),s("code",[this._v("docker stop gitlab")]),this._v("。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[this._v("docker stop gitlab\ndocker rm gitlab\ndocker network rm gitlab-net\ndocker volume rm gitlab-config gitlab-datagitlab-logs\n")])]),this._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[this._v("1")]),s("br"),s("span",{staticClass:"line-number"},[this._v("2")]),s("br"),s("span",{staticClass:"line-number"},[this._v("3")]),s("br"),s("span",{staticClass:"line-number"},[this._v("4")]),s("br")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"三、22端口占用，修改22端口"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#三、22端口占用，修改22端口","aria-hidden":"true"}},[this._v("#")]),this._v(" 三、22端口占用，修改22端口")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"关闭selinux的两种方法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#关闭selinux的两种方法","aria-hidden":"true"}},[this._v("#")]),this._v(" 关闭SELinux的两种方法")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"_1-永久方法-–-需要重启服务器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-永久方法-–-需要重启服务器","aria-hidden":"true"}},[this._v("#")]),this._v(" 1 永久方法 – 需要重启服务器")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"_2-临时方法-–-设置系统参数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-临时方法-–-设置系统参数","aria-hidden":"true"}},[this._v("#")]),this._v(" 2 临时方法 – 设置系统参数")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[this._v("vim /etc/ssh/sshd_config\n")])]),this._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[this._v("1")]),s("br")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("strong",[this._v("第二步："),s("strong",[this._v("如果你关闭了")]),this._v("SELinux")]),this._v("**，**可以忽略第二步。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[this._v("semanage port -l|grep ssh\n")])]),this._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[this._v("1")]),s("br")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[this._v("semanage port -a -t ssh_port_t -p tcp 10086\n")])]),this._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[this._v("1")]),s("br")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[this._v("semanage port -l|grep ssh\n")])]),this._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[this._v("1")]),s("br")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[this._v("firewall-cmd --permanent --query-port=10086/tcp\n")])]),this._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[this._v("1")]),s("br")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[this._v("firewall-cmd --permanent --add-port=10086/tcp\n")])]),this._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[this._v("1")]),s("br")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"三、使用ssh下载报错"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#三、使用ssh下载报错","aria-hidden":"true"}},[this._v("#")]),this._v(" 三、使用ssh下载报错")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[this._v("gitlab_rails['gitlab_shell_ssh_port'] = 22\n")])]),this._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[this._v("1")]),s("br")])])}],!1,null,null,null);s.default=n.exports}}]);